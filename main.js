(()=>{"use strict";var t=function(t){var e=t.inputList,n=t.buttonElement,r=t.inactiveButtonClass;!function(t){return null==t?void 0:t.some((function(t){return!t.validity.valid}))}(e)?(n.disabled=!1,n.classList.remove(r)):(n.disabled=!0,n.classList.add(r))};function e(t){t.classList.add("popup_opened"),document.addEventListener("keydown",r)}function n(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&n(document.querySelector(".popup_opened"))}var o=document.querySelector(".content"),c=document.querySelector(".popup__profile"),s=c.querySelector(".popup__item_type_name"),i=c.querySelector(".popup__item_type_hobby"),a=document.querySelector(".popup__ava-edit"),u={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"3f27fbc7-1295-4006-b957-4324314762dc","Content-Type":"application/json"}},l=document.querySelector("#template-list-item").content,p=document.querySelector(".popup__open-cards"),d=document.querySelector(".popup__add-cards"),m=p.querySelector(".popup__image"),f=p.querySelector(".caption"),_=d.querySelector(".popup__item_type_name-card"),v=d.querySelector(".popup__item_type_link"),h=o.querySelector(".list");function y(t){var n=function(t){var n=t.name,r=t.link,c=t.likes,s=t._id,i=t.owner,a=l.querySelector(".list__item").cloneNode(!0),d=a.querySelector(".list__img");a.querySelector(".list__text").textContent=n,d.src=r,d.alt=n;var _=a.querySelector(".list__like-counter");return _.textContent=c.length,a.querySelector(".list__like-button").addEventListener("click",(function(t){!function(t,e,n){var r;t.target.classList.contains("list__like-button_active")?(r=e,fetch("".concat(u.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:u.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){n.textContent=t.likes.length})).catch((function(t){return console.log(t)})):function(t){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:u.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e).then((function(t){n.textContent=t.likes.length})).catch((function(t){return console.log(t)})),t.target.classList.toggle("list__like-button_active")}(t,s,_)})),window.userId===i._id&&(function(t){var e=document.createElement("button");e.classList.add("trash"),e.setAttribute("type","button"),e.setAttribute("aria-label","Корзина"),t.querySelector(".list__img").after(e)}(a),a.querySelector(".trash").addEventListener("click",(function(t){var e;(e=s,fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){return t.target.closest(".list__item").remove()})).catch((function(t){return o.log(t)}))}))),d.addEventListener("click",(function(){e(p),m.src=r,m.alt=n,f.textContent=n})),a}(t);h.prepend(n)}fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){y(t)}))})).catch((function(t){return console.log(t)}));var b,E,S,C,q,L,g,k=o.querySelector(".profile__name"),x=o.querySelector(".profile__hobby"),j=o.querySelector(".profile__img"),P=a.querySelector(".popup__item_type_ava"),A=document.querySelectorAll(".popup"),B=c.querySelector(".popup__form"),U=d.querySelector(".popup__form"),w=a.querySelector(".popup__form"),T=o.querySelector(".profile__edit-button"),D=o.querySelector(".profile__add-button"),M=o.querySelector(".profile__ava-button");fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){var e=t.name,n=t.about,r=t.avatar,o=t._id;window.userId=o,k.textContent=e,x.textContent=n,j.src=r})).catch((function(t){return console.log(t)})),T.addEventListener("click",(function(){var t,n;t=document.querySelectorAll(".popup__item-error_active"),n=document.querySelectorAll(".popup__item_type_error"),t.forEach((function(t){t.classList.remove("popup__item-error_active")})),n.forEach((function(t){t.classList.remove("popup__item_type_error")})),s.value=k.textContent,i.value=x.textContent,e(c)})),D.addEventListener("click",(function(){e(d)})),M.addEventListener("click",(function(){e(a)})),A.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&n(t),e.target.classList.contains("popup__close")&&n(t)}))})),B.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохрание...",(e=s.value,r=i.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:r})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){var e=t.name,r=t.about;k.textContent=e,x.textContent=r,n(c)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Сохранить"}))})),U.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=_.value,r=v.value,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:r})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){y(t),n(d)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Создать",t.submitter.classList.add("popup__form-button_inactive"),t.submitter.disabled=!0,t.target.reset()}))})),w.addEventListener("submit",(function(t){var e;t.preventDefault(),t.submitter.textContent="Сохрание...",(e=P.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){j.src=t.avatar,n(a)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Сохранить",t.target.reset()}))})),E=(b={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,S=b.inputSelector,C=b.submitButtonSelector,q=b.inactiveButtonClass,L=b.inputErrorClass,g=b.errorClass,Array.from(document.querySelectorAll(E)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(e){var n=e.formElement,r=e.inputSelector,o=e.submitButtonSelector,c=e.inactiveButtonClass,s=e.inputErrorClass,i=e.errorClass,a=Array.from(n.querySelectorAll(r)),u=n.querySelector(o);t({inputList:a,buttonElement:u,inactiveButtonClass:c}),a.forEach((function(e){e.addEventListener("input",(function(){!function(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t){var e=t.inputElement,n=t.inputErrorClass,r=t.errorClass,o=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),o.classList.remove(r)}({formElement:e,inputElement:n,inputErrorClass:r,errorClass:o}):function(t){var e=t.inputElement,n=t.errorMesage,r=t.inputErrorClass,o=t.errorClass,c=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(r),c.classList.add(o),c.textContent=n}({formElement:e,inputElement:n,errorMesage:n.validationMessage,inputErrorClass:r,errorClass:o})}({formElement:n,inputElement:e,inputErrorClass:s,errorClass:i}),t({inputList:a,buttonElement:u,inactiveButtonClass:c})}))}))}({formElement:e,inputSelector:S,submitButtonSelector:C,inactiveButtonClass:q,inputErrorClass:L,errorClass:g})}))})();