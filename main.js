(()=>{"use strict";var e=function(e){var t=e.inputList,r=e.buttonElement,n=e.inactiveButtonClass;!function(e){return null==e?void 0:e.some((function(e){return!e.validity.valid}))}(t)?(r.disabled=!1,r.classList.remove(n)):(r.disabled=!0,r.classList.add(n))};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}var o=document.querySelector(".content"),i=document.querySelector(".popup__profile"),u=i.querySelector(".popup__item_type_name"),a=i.querySelector(".popup__item_type_hobby"),c=document.querySelector(".popup__ava-edit"),s={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"3f27fbc7-1295-4006-b957-4324314762dc","Content-Type":"application/json"}};function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var p=document.querySelector("#template-list-item").content,d=document.querySelector(".popup__open-cards"),m=document.querySelector(".popup__add-cards"),f=d.querySelector(".popup__image"),_=d.querySelector(".caption"),v=m.querySelector(".popup__item_type_name-card"),y=m.querySelector(".popup__item_type_link"),h=o.querySelector(".list");function b(e){var r=function(e){var r=e.name,n=e.link,i=e.likes,u=e._id,a=e.owner,c=p.querySelector(".list__item").cloneNode(!0),m=c.querySelector(".list__img");c.querySelector(".list__text").textContent=r,m.src=n,m.alt=r;var v=c.querySelector(".list__like-counter");return v.textContent=i.length,c.querySelector(".list__like-button").addEventListener("click",(function(e){handlLikeCard(e,u,v)})),window.userId===a._id&&(function(e){var t=document.createElement("button");t.classList.add("trash"),t.setAttribute("type","button"),t.setAttribute("aria-label","Корзина"),e.querySelector(".list__img").after(t)}(c),c.querySelector(".trash").addEventListener("click",(function(e){var t;(t=u,fetch("".concat(s.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:s.headers}).then((function(e){l(e)}))).then((function(){return e.target.closest(".list__item").remove()})).catch((function(e){return o.log(e)}))}))),m.addEventListener("click",(function(){t(d),f.src=n,f.alt=r,_.textContent=r})),c}(e);h.prepend(r)}fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){l(e)})).then((function(e){e.forEach((function(e){b(e)}))})).catch((function(e){return console.log(e)}));var S,E,C,q,L,g,k,x=o.querySelector(".profile__name"),A=o.querySelector(".profile__hobby"),B=o.querySelector(".profile__img"),w=c.querySelector(".popup__item_type_ava"),U=document.querySelectorAll(".popup"),D=i.querySelector(".popup__form"),M=m.querySelector(".popup__form"),T=c.querySelector(".popup__form"),N=o.querySelector(".profile__edit-button"),O=o.querySelector(".profile__add-button"),P=o.querySelector(".profile__ava-button");fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){l(e)})).then((function(e){var t=e.name,r=e.about,n=e.avatar,o=e._id;window.userId=o,x.textContent=t,A.textContent=r,B.src=n})).catch((function(e){return console.log(e)})),N.addEventListener("click",(function(){var e,r;e=document.querySelectorAll(".popup__item-error_active"),r=document.querySelectorAll(".popup__item_type_error"),e.forEach((function(e){e.classList.remove("popup__item-error_active")})),r.forEach((function(e){e.classList.remove("popup__item_type_error")})),u.value=x.textContent,a.value=A.textContent,t(i)})),O.addEventListener("click",(function(){t(m)})),P.addEventListener("click",(function(){t(c)})),U.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&r(e),t.target.classList.contains("popup__close")&&r(e)}))})),D.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохрание...",(t=u.value,n=a.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){l(e)}))).then((function(e){var t=e.name,n=e.about;x.textContent=t,A.textContent=n,r(i)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),M.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.submitter.textContent="Сохранение...",(t=v.value,n=y.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){l(e)}))).then((function(e){b(e),r(m)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Создать",e.submitter.classList.add("popup__form-button_inactive"),e.submitter.disabled=!0,e.target.reset()}))})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),e.submitter.textContent="Сохрание...",(t=w.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){l(e)}))).then((function(e){B.src=e.avatar,r(c)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Сохранить",e.target.reset()}))})),E=(S={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,C=S.inputSelector,q=S.submitButtonSelector,L=S.inactiveButtonClass,g=S.inputErrorClass,k=S.errorClass,Array.from(document.querySelectorAll(E)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t){var r=t.formElement,n=t.inputSelector,o=t.submitButtonSelector,i=t.inactiveButtonClass,u=t.inputErrorClass,a=t.errorClass,c=Array.from(r.querySelectorAll(n)),s=r.querySelector(o);e({inputList:c,buttonElement:s,inactiveButtonClass:i}),c.forEach((function(t){t.addEventListener("input",(function(){!function(e){var t=e.formElement,r=e.inputElement,n=e.inputErrorClass,o=e.errorClass;r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?function(e){var t=e.inputElement,r=e.inputErrorClass,n=e.errorClass,o=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),o.classList.remove(n)}({formElement:t,inputElement:r,inputErrorClass:n,errorClass:o}):function(e){var t=e.inputElement,r=e.errorMesage,n=e.inputErrorClass,o=e.errorClass,i=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(n),i.classList.add(o),i.textContent=r}({formElement:t,inputElement:r,errorMesage:r.validationMessage,inputErrorClass:n,errorClass:o})}({formElement:r,inputElement:t,inputErrorClass:u,errorClass:a}),e({inputList:c,buttonElement:s,inactiveButtonClass:i})}))}))}({formElement:t,inputSelector:C,submitButtonSelector:q,inactiveButtonClass:L,inputErrorClass:g,errorClass:k})}))})();