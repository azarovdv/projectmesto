(()=>{"use strict";var t=function(t){var e=t.inputList,n=t.buttonElement,r=t.inactiveButtonClass;!function(t){return null==t?void 0:t.some((function(t){return!t.validity.valid}))}(e)?(n.disabled=!1,n.classList.remove(r)):(n.disabled=!0,n.classList.add(r))};function e(t){t.classList.add("popup_opened"),document.addEventListener("keydown",r)}function n(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&n(document.querySelector(".popup_opened"))}var o=document.querySelector(".content"),c=document.querySelector(".popup__profile"),i=c.querySelector(".popup__item_type_name"),a=c.querySelector(".popup__item_type_hobby"),u=document.querySelector(".popup__ava-edit"),s={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"3f27fbc7-1295-4006-b957-4324314762dc","Content-Type":"application/json"}};function l(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var p=document.querySelector("#template-list-item").content,d=document.querySelector(".popup__open-cards"),m=document.querySelector(".popup__add-cards"),f=d.querySelector(".popup__image"),_=d.querySelector(".caption"),v=m.querySelector(".popup__item_type_name-card"),h=m.querySelector(".popup__item_type_link"),y=o.querySelector(".list");function b(t){var n=function(t){var n=t.name,r=t.link,c=t.likes,i=t._id,a=t.owner,u=p.querySelector(".list__item").cloneNode(!0),m=u.querySelector(".list__img");u.querySelector(".list__text").textContent=n,m.src=r,m.alt=n;var v=u.querySelector(".list__like-counter");return v.textContent=c.length,u.querySelector(".list__like-button").addEventListener("click",(function(t){!function(t,e,n){var r;t.target.classList.contains("list__like-button_active")?(r=e,fetch("".concat(s.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:s.headers}).then((function(t){l(t)}))).then((function(t){n.textContent=t.likes.length})).catch((function(t){return console.log(t)})):function(t){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:s.headers}).then((function(t){l(t)}))}(e).then((function(t){n.textContent=t.likes.length})).catch((function(t){return console.log(t)})),t.target.classList.toggle("list__like-button_active")}(t,i,v)})),window.userId===a._id&&(function(t){var e=document.createElement("button");e.classList.add("trash"),e.setAttribute("type","button"),e.setAttribute("aria-label","Корзина"),t.querySelector(".list__img").after(e)}(u),u.querySelector(".trash").addEventListener("click",(function(t){var e;(e=i,fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(t){l(t)}))).then((function(){return t.target.closest(".list__item").remove()})).catch((function(t){return o.log(t)}))}))),m.addEventListener("click",(function(){e(d),f.src=r,f.alt=n,_.textContent=n})),u}(t);y.prepend(n)}fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(t){l(t)})).then((function(t){t.forEach((function(t){b(t)}))})).catch((function(t){return console.log(t)}));var E,S,C,q,L,g,k,x=o.querySelector(".profile__name"),A=o.querySelector(".profile__hobby"),B=o.querySelector(".profile__img"),U=u.querySelector(".popup__item_type_ava"),w=document.querySelectorAll(".popup"),T=c.querySelector(".popup__form"),D=m.querySelector(".popup__form"),M=u.querySelector(".popup__form"),P=o.querySelector(".profile__edit-button"),N=o.querySelector(".profile__add-button"),O=o.querySelector(".profile__ava-button");fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(t){l(t)})).then((function(t){var e=t.name,n=t.about,r=t.avatar,o=t._id;window.userId=o,x.textContent=e,A.textContent=n,B.src=r})).catch((function(t){return console.log(t)})),P.addEventListener("click",(function(){var t,n;t=document.querySelectorAll(".popup__item-error_active"),n=document.querySelectorAll(".popup__item_type_error"),t.forEach((function(t){t.classList.remove("popup__item-error_active")})),n.forEach((function(t){t.classList.remove("popup__item_type_error")})),i.value=x.textContent,a.value=A.textContent,e(c)})),N.addEventListener("click",(function(){e(m)})),O.addEventListener("click",(function(){e(u)})),w.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&n(t),e.target.classList.contains("popup__close")&&n(t)}))})),T.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохрание...",(e=i.value,r=a.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:r})}).then((function(t){l(t)}))).then((function(t){var e=t.name,r=t.about;x.textContent=e,A.textContent=r,n(c)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Сохранить"}))})),D.addEventListener("submit",(function(t){var e,r;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=v.value,r=h.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:r})}).then((function(t){l(t)}))).then((function(t){b(t),n(m)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Создать",t.submitter.classList.add("popup__form-button_inactive"),t.submitter.disabled=!0,t.target.reset()}))})),M.addEventListener("submit",(function(t){var e;t.preventDefault(),t.submitter.textContent="Сохрание...",(e=U.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then((function(t){l(t)}))).then((function(t){B.src=t.avatar,n(u)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Сохранить",t.target.reset()}))})),S=(E={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,C=E.inputSelector,q=E.submitButtonSelector,L=E.inactiveButtonClass,g=E.inputErrorClass,k=E.errorClass,Array.from(document.querySelectorAll(S)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(e){var n=e.formElement,r=e.inputSelector,o=e.submitButtonSelector,c=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(n.querySelectorAll(r)),s=n.querySelector(o);t({inputList:u,buttonElement:s,inactiveButtonClass:c}),u.forEach((function(e){e.addEventListener("input",(function(){!function(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t){var e=t.inputElement,n=t.inputErrorClass,r=t.errorClass,o=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),o.classList.remove(r)}({formElement:e,inputElement:n,inputErrorClass:r,errorClass:o}):function(t){var e=t.inputElement,n=t.errorMesage,r=t.inputErrorClass,o=t.errorClass,c=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(r),c.classList.add(o),c.textContent=n}({formElement:e,inputElement:n,errorMesage:n.validationMessage,inputErrorClass:r,errorClass:o})}({formElement:n,inputElement:e,inputErrorClass:i,errorClass:a}),t({inputList:u,buttonElement:s,inactiveButtonClass:c})}))}))}({formElement:e,inputSelector:C,submitButtonSelector:q,inactiveButtonClass:L,inputErrorClass:g,errorClass:k})}))})();