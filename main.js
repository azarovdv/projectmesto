(()=>{"use strict";var t=function(t){var e=t.inputList,r=t.buttonElement,n=t.inactiveButtonClass;!function(t){return null==t?void 0:t.some((function(t){return!t.validity.valid}))}(e)?(r.disabled=!1,r.classList.remove(n)):(r.disabled=!0,r.classList.add(n))};function e(t){t.classList.add("popup_opened"),document.addEventListener("keydown",n)}function r(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(t){"Escape"===t.key&&r(document.querySelector(".popup_opened"))}function o(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":r}var i=document.querySelector(".content"),a=document.querySelector(".popup__profile"),u=a.querySelector(".popup__item_type_name"),c=a.querySelector(".popup__item_type_hobby"),s=document.querySelector(".popup__ava-edit"),l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-28",headers:{authorization:"3f27fbc7-1295-4006-b957-4324314762dc","Content-Type":"application/json"}};function p(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var d=document.querySelector("#template-list-item").content,f=document.querySelector(".popup__open-cards"),m=document.querySelector(".popup__add-cards"),_=f.querySelector(".popup__image"),v=f.querySelector(".caption"),y=m.querySelector(".popup__item_type_name-card"),h=m.querySelector(".popup__item_type_link"),b=i.querySelector(".list");function S(t){var r=function(t){var r=t.name,n=t.link,o=t.likes,a=t._id,u=t.owner,c=d.querySelector(".list__item").cloneNode(!0),s=c.querySelector(".list__img");c.querySelector(".list__text").textContent=r,s.src=n,s.alt=r;var m=c.querySelector(".list__like-counter");return m.textContent=o.length,c.querySelector(".list__like-button").addEventListener("click",(function(t){!function(t,e,r){var n;t.target.classList.contains("list__like-button_active")?(n=e,fetch("".concat(l.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:l.headers}).then((function(t){return p(t)}))).then((function(e){t.target.classList.toggle("list__like-button_active"),r.textContent=e.likes.length})).catch((function(t){return console.log(t)})):function(t){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:l.headers}).then((function(t){return p(t)}))}(e).then((function(e){t.target.classList.toggle("list__like-button_active"),r.textContent=e.likes.length})).catch((function(t){return console.log(t)}))}(t,a,m)})),window.userId===u._id&&(function(t){var e=document.createElement("button");e.classList.add("trash"),e.setAttribute("type","button"),e.setAttribute("aria-label","Корзина"),t.querySelector(".list__img").after(e)}(c),c.querySelector(".trash").addEventListener("click",(function(t){var e;(e=a,fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(t){return p(t)}))).then((function(){return t.target.closest(".list__item").remove()})).catch((function(t){return i.log(t)}))}))),s.addEventListener("click",(function(){e(f),_.src=n,_.alt=r,v.textContent=r})),c}(t);b.prepend(r)}var E=i.querySelector(".profile__name"),C=i.querySelector(".profile__hobby"),g=i.querySelector(".profile__img"),q=s.querySelector(".popup__item_type_ava");function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var k,A,x,w,B,U,j,O=document.querySelectorAll(".popup"),T=a.querySelector(".popup__form"),D=m.querySelector(".popup__form"),M=s.querySelector(".popup__form"),P=i.querySelector(".profile__edit-button"),I=i.querySelector(".profile__add-button"),N=i.querySelector(".profile__ava-button");Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(t){return p(t)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(t){return p(t)}))]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(e,r)||function(t,e){if(t){if("string"==typeof t)return L(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1],a=o.name,u=o.about,c=o.avatar,s=o._id;return window.userId=s,E.textContent=a,C.textContent=u,g.src=c,i.forEach((function(t){S(t)})),t})).catch((function(t){return console.log(t)})),P.addEventListener("click",(function(){var t,r,n;t=document.querySelectorAll(".popup__item-error_active"),r=document.querySelectorAll(".popup__item_type_error"),t.forEach((function(t){t.classList.remove("popup__item-error_active")})),r.forEach((function(t){t.classList.remove("popup__item_type_error")})),u.value=E.textContent,c.value=C.textContent,e(a),(n=a.querySelector(".popup__form-button")).hasAttribute("disabled")&&n.removeAttribute("disabled")})),I.addEventListener("click",(function(){e(m)})),N.addEventListener("click",(function(){e(s)})),O.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&r(t),e.target.classList.contains("popup__close")&&r(t)}))})),T.addEventListener("submit",(function(t){var e,n;t.preventDefault(),o(!0,t.submitter),t.submitter.disabled=!0,(e=u.value,n=c.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){return p(t)}))).then((function(t){var e=t.name,n=t.about;E.textContent=e,C.textContent=n,r(a)})).catch((function(t){return console.log(t)})).finally((function(){o(!1,t.submitter)}))})),D.addEventListener("submit",(function(t){var e,n;t.preventDefault(),o(!0,t.submitter),(e=y.value,n=h.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:n})}).then((function(t){return p(t)}))).then((function(t){S(t),r(m)})).catch((function(t){return console.log(t)})).finally((function(){o(!1,t.submitter,"Создать"),t.submitter.classList.add("popup__form-button_inactive"),t.submitter.disabled=!0,t.target.reset()}))})),M.addEventListener("submit",(function(t){var e;t.preventDefault(),o(!0,t.submitter),(e=q.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then((function(t){return p(t)}))).then((function(t){g.src=t.avatar,r(s)})).catch((function(t){return console.log(t)})).finally((function(){o(!1,t.submitter),t.target.reset()}))})),A=(k={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,x=k.inputSelector,w=k.submitButtonSelector,B=k.inactiveButtonClass,U=k.inputErrorClass,j=k.errorClass,Array.from(document.querySelectorAll(A)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(e){var r=e.formElement,n=e.inputSelector,o=e.submitButtonSelector,i=e.inactiveButtonClass,a=e.inputErrorClass,u=e.errorClass,c=Array.from(r.querySelectorAll(n)),s=r.querySelector(o);t({inputList:c,buttonElement:s,inactiveButtonClass:i}),c.forEach((function(e){e.addEventListener("input",(function(){!function(t){var e=t.formElement,r=t.inputElement,n=t.inputErrorClass,o=t.errorClass;r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?function(t){var e=t.inputElement,r=t.inputErrorClass,n=t.errorClass,o=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),o.classList.remove(n)}({formElement:e,inputElement:r,inputErrorClass:n,errorClass:o}):function(t){var e=t.inputElement,r=t.errorMesage,n=t.inputErrorClass,o=t.errorClass,i=t.formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(n),i.classList.add(o),i.textContent=r}({formElement:e,inputElement:r,errorMesage:r.validationMessage,inputErrorClass:n,errorClass:o})}({formElement:r,inputElement:e,inputErrorClass:a,errorClass:u}),t({inputList:c,buttonElement:s,inactiveButtonClass:i})}))}))}({formElement:e,inputSelector:x,submitButtonSelector:w,inactiveButtonClass:B,inputErrorClass:U,errorClass:j})}))})();